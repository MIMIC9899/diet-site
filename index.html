

<html>
<head>
    <title>–î–∏–µ—Ç–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a202c;
            color: #f7fafc;
        }
        .form-input, .form-button {
            background-color: #4a5568;
            color: #f7fafc;
        }
        .form-button {
            transition: background-color 0.3s;
        }
        .form-button:hover {
            background-color: #2d3748;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center">
    <div class="max-w-4xl w-full p-4 mx-2">
        <h1 class="text-3xl text-center mb-8">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–∏–µ—Ç—ã</h1>
        <div id="points-display" class="text-center mb-8 text-lg">
            –û—á–∫–∏: <span id="diet-points">0</span> üéØ <span id="diet-points-message"></span>
        </div>
        <form id="diet-form" class="flex flex-col space-y-4">
            <input type="number" class="form-input p-2 rounded" id="cal-consumed" placeholder="–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏" required>
            <input type="number" class="form-input p-2 rounded" id="cal-burned" placeholder="–°–æ–∂–∂—ë–Ω–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏" required>
            <button type="button" class="form-button p-2 rounded text-lg" onclick="calculateDietPoints()">–ù–∞–∂–º–∏ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ—á–∫–æ–≤ üçé</button>
        </form>
        <div id="diet-points-output" class="mt-4 p-4 border-t-2 border-gray-600 text-center">
            <!-- Diet Points Output will appear here -->
        </div>
        
        <form id="store-form" class="flex flex-col space-y-4 mt-8">
            <input type="text" class="form-input p-2 rounded" id="item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞" required>
            <input type="number" class="form-input p-2 rounded" id="item-price" placeholder="–¶–µ–Ω–∞" required>
            <button type="button" class="form-button p-2 rounded text-lg" onclick="addItemToStore()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω üõí</button> 
            <span id="store-message"></span>
        </form>
        <div id="store-output" class="mt-4 p-4 border-t-2 border-gray-600"> 
            <h2 class="text-xl mb-2">–ú–∞–≥–∞–∑–∏–Ω</h2>
            <ul id="store-list">
                <!-- Store items will appear here -->
            </ul>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mt-4">
            <div id="purchase-history-output" class="flex-1 p-4 border-t-2 border-gray-600">
                <h2 class="text-xl mb-2">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h2>
                <ul id="purchase-history">
                    <!-- Purchase history will appear here -->
                </ul>
            </div>

            <div id="points-history-output" class="flex-1 p-4 border-t-2 border-gray-600">
                <h2 class="text-xl mb-2">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤</h2>
                <ul id="points-history">
                    <!-- Points history will appear here -->
                </ul>
            </div>
        </div>

    </div>
   
    <script>
        const localStorageKey = 'dietAppStore';
        const pointsKey = 'dietPoints';
        const purchaseHistoryKey = 'purchaseHistory';
        const pointsHistoryKey = 'pointsHistory';

        document.addEventListener('DOMContentLoaded', () => {
            loadStoredDietPoints();
            loadStoreItems();
            loadPurchaseHistory();
            loadPointsHistory();
        });

        function loadStoredDietPoints() {
            const savedPoints = parseInt(localStorage.getItem(pointsKey)) || 0;
            document.getElementById('diet-points').innerText = savedPoints;
        }

        function calculateDietPoints() {
            const calConsumed = parseInt(document.getElementById('cal-consumed').value);
            const calBurned = parseInt(document.getElementById('cal-burned').value);
            if (isNaN(calConsumed) || isNaN(calBurned)) {
                alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ –∫–∞–ª–æ—Ä–∏–π –≤ –æ–±–∞ –ø–æ–ª—è");
                return;
            }
            const points = calBurned * 2 - calConsumed;
            const pointsOutput = document.getElementById('diet-points-output');
            if (points > 0 && points < 10000) {
                pointsOutput.innerText = `–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª ${points} –æ—á–∫–æ–≤! üéâ`;
                updateDietPoints(points, calConsumed, calBurned);
            } else if (points < 0){
                pointsOutput.innerText = `–û–æ–æ –Ω–µ—Ç! –¢—ã –ø–æ—Ç–µ—Ä—è–ª ${points} –æ—á–∫–æ–≤! üéâ`;
                updateDietPoints(points, calConsumed, calBurned);
            } else if (points == 0){
                pointsOutput.innerText = `–¢—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª`;
                updateDietPoints(points, calConsumed, calBurned);
            } else {
                pointsOutput.innerText = `–ê —Ç—ã –Ω–æ–ª–∏–∫–æ–º –Ω–µ –æ—à–∏–±—Å—è?`;
            } 
            
        }

        function updateDietPoints(points, calConsumed, calBurned) {
            let currentPoints = parseInt(localStorage.getItem(pointsKey)) || 0;
            currentPoints += points;
            localStorage.setItem(pointsKey, currentPoints);
            if (currentPoints > 100000){
                const pointsOutput = document.getElementById('diet-points-message');
                pointsOutput.innerText = `–ê –Ω–µ –º–Ω–æ–≥–æ–≤–∞—Ç–æ?`;
            } else {
                const pointsOutput = document.getElementById('diet-points-message');
                pointsOutput.innerText = ``;
            }
            document.getElementById('diet-points').innerText = currentPoints;
            let pointsHistory = JSON.parse(localStorage.getItem(pointsHistoryKey)) || [];
            const changeRecord = {
                date: new Date().toLocaleString(),
                change: points,
                total: currentPoints,
                details: {
                    consumed: calConsumed,
                    burned: calBurned,
                    calculation: `(${calBurned} √ó 2) - ${calConsumed} = ${points}`
                }
            };
            pointsHistory.push(changeRecord);
            localStorage.setItem(pointsHistoryKey, JSON.stringify(pointsHistory));
            loadPointsHistory();
        }

        function addItemToStore() {
            const itemName = document.getElementById('item-name').value;
            const itemPrice = parseInt(document.getElementById('item-price').value);
            if (!itemName || isNaN(itemPrice) || itemPrice <= 0) {
                alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é —Ü–µ–Ω—É");
                return;
            }

            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            let itemExists = false;
            storeItems.forEach((item, index) => {
                if(itemName==item.name){
                    itemExists = true;
                }
            });
            const storeMessage = document.getElementById('store-message');
            if(itemExists == false){
                storeItems.push({ name: itemName, price: itemPrice });
                storeMessage.innerText = ``;
            }
            else{
                storeMessage.innerText = `–¢–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –µ—Å—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ`;
            }
            localStorage.setItem(localStorageKey, JSON.stringify(storeItems));
            loadStoreItems();
        }


        function loadStoreItems() {
            const storeList = document.getElementById('store-list');
            storeList.innerHTML = ''; 

            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            storeItems.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'my-1 p-2 bg-gray-800 rounded flex justify-between items-center';
                if ([2,3,4].includes(item.price))    {
                    listItem.innerHTML = `${item.name} - ${item.price} –æ—á–∫–∞ 
                    <div class="flex">
                        <button onclick="purchaseItem(${index})" class="bg-green-600 hover:bg-green-500 text-white p-1 rounded mr-2">–ö—É–ø–∏—Ç—å</button>
                        <button onclick="removeItemFromStore(${index})" class="bg-red-600 hover:bg-red-500 text-white p-1 rounded">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>`;
                } else {
                    listItem.innerHTML = `${item.name} - ${item.price} –æ—á–∫–æ–≤ 
                    <div class="flex">
                        <button onclick="purchaseItem(${index})" class="bg-green-600 hover:bg-green-500 text-white p-1 rounded mr-2">–ö—É–ø–∏—Ç—å</button>
                        <button onclick="removeItemFromStore(${index})" class="bg-red-600 hover:bg-red-500 text-white p-1 rounded">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>`;
                }
                storeList.appendChild(listItem);
            });
        }

        function loadPurchaseHistory() {
            const purchaseList = document.getElementById('purchase-history');
            purchaseList.innerHTML = ''; // Clear current list

            let purchaseHistory = JSON.parse(localStorage.getItem(purchaseHistoryKey)) || [];
            purchaseHistory.forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'my-1 p-2 bg-gray-800 rounded';
                listItem.innerHTML = `
                    <div class="text-sm text-gray-400">${item.date}</div>
                    <div class="text-sm mt-1">${item.details.name} - –ö—É–ø–ª–µ–Ω–æ –∑–∞ ${item.details.price} –æ—á–∫–æ–≤</div>
                `;
                purchaseList.appendChild(listItem);
            });
        }

        function loadPointsHistory() {
            const pointsList = document.getElementById('points-history');
            pointsList.innerHTML = '';

            let pointsHistory = JSON.parse(localStorage.getItem(pointsHistoryKey)) || [];
            pointsHistory.slice().reverse().forEach(record => { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–≤—ã–º–∏
                const listItem = document.createElement('li');
                listItem.className = 'my-1 p-2 bg-gray-800 rounded';
                
                const changeClass = record.change > 0 ? 'text-green-400' : 'text-red-400';
                const changeSymbol = record.change > 0 ? '+' : '';
                
                listItem.innerHTML = `
                    <div class="text-sm text-gray-400">${record.date}</div>
                    <div class="text-sm mt-1">–ü–æ–ª—É—á–µ–Ω–æ: ${record.details.consumed} –∫–∞–ª | –°–æ–∂–∂–µ–Ω–æ: ${record.details.burned} –∫–∞–ª</div>
                    <div class="text-sm">–†–∞—Å—á—ë—Ç: ${record.details.calculation}</div>
                    <div class="text-right mt-1">–ò—Ç–æ–≥–æ: ${record.total} –æ—á–∫–æ–≤</div>
                `;
                pointsList.appendChild(listItem);
            });
        }

        function removeItemFromStore(index) {
            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            if (index >= 0 && index < storeItems.length) {
                storeItems.splice(index, 1);
                localStorage.setItem(localStorageKey, JSON.stringify(storeItems));
                loadStoreItems();
            } 
        }
        
        function purchaseItem(index) {
            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            let purchaseHistory = JSON.parse(localStorage.getItem(purchaseHistoryKey)) || [];
            let currentPoints = parseInt(localStorage.getItem(pointsKey)) || 0;
            const itemPrice = storeItems[index].price;
            const itemName = storeItems[index].name;
            if (currentPoints >= itemPrice) {
                currentPoints -= itemPrice;
                let purchasedItem = storeItems[index]; 
                const changeRecord = {
                    date: new Date().toLocaleString(),
                    details: {
                        name: itemName,
                        price: itemPrice
                    }
                };
                purchaseHistory.push(changeRecord);
                localStorage.setItem(purchaseHistoryKey, JSON.stringify(purchaseHistory));
                localStorage.setItem(pointsKey, currentPoints);
                if (currentPoints < 100000){
                    const pointsOutput = document.getElementById('diet-points-message');
                    pointsOutput.innerText = ``;
                } 
                document.getElementById('diet-points').innerText = currentPoints;
                loadPurchaseHistory();
                alert("–¢—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª –ø—Ä–µ–¥–º–µ—Ç: " + itemName + "!");
            } else {
                alert("–£ —Ç–µ–±—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!");
            }
        }
    </script>
</body>
</html>
