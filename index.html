<html>
<head>
    <title>–î–∏–µ—Ç–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a202c;
            color: #f7fafc;
        }
        .form-input, .form-button {
            background-color: #4a5568;
            color: #f7fafc;
        }
        .form-button {
            transition: background-color 0.3s;
        }
        .form-button:hover {
            background-color: #2d3748;
        }
        .reset-button {
            transition: background-color 0.2s, transform 0.2s;
        }
        .reset-button:hover {
            background-color: #c53030;
            transform: scale(1.05);
        }
        .auth-input {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            color: #f7fafc;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            margin-bottom: 1rem;
        }
        .auth-input:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.3);
        }
        .auth-button {
            background-color: #4299e1;
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .auth-button:hover {
            background-color: #3182ce;
            transform: translateY(-1px);
        }
        .auth-container {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            border: 1px solid #4a5568;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
        .badge-healthy { background-color: #38a169; }
        .badge-warning { background-color: #dd6b20; }
        .badge-danger { background-color: #e53e3e; }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center">

    <div id="auth-container" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-50 px-4">
        <div class="auth-container p-8 rounded-xl max-w-md w-full">
            <h2 class="text-2xl font-bold mb-6 text-center text-white">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <div class="space-y-4">
                <input type="text" id="auth-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω" class="auth-input" autocomplete="username">
                <input type="password" id="auth-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" class="auth-input" autocomplete="current-password">
                <button onclick="login()" class="auth-button bg-blue-600 hover:bg-blue-700">–í–æ–π—Ç–∏</button>
                <button onclick="register()" class="auth-button bg-green-600 hover:bg-green-700">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <p class="text-gray-400 text-sm text-center mt-4">
                    –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
                </p>
            </div>
        </div>
    </div>
    <div class="max-w-4xl w-full p-4 mx-2">
        <div id="app-content" class="hidden max-w-4xl w-full p-4 mx-2">
            <div class="relative">
                <button onclick="logout()" class="reset-button top-0 right-20 bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded-lg text-sm shadow-md">
                    –í—ã–π—Ç–∏
                </button>
                <button onclick="resetUserData()" class="reset-button top-0 –¥-0 bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-lg text-sm shadow-md">
                    –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
            <h1 class="text-3xl text-center mb-8">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–∏–µ—Ç—ã</h1>
            <div id="points-display" class="text-center mb-8 text-lg">
                –û—á–∫–∏: <span id="diet-points">0</span> üéØ <span id="diet-points-message"></span>
            </div>
            <form id="diet-form" class="flex flex-col space-y-4">
                <input type="number" class="form-input p-2 rounded" id="cal-consumed" placeholder="–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏" required>
                <input type="number" class="form-input p-2 rounded" id="cal-burned" placeholder="–°–æ–∂–∂—ë–Ω–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏" required>
                <button type="button" class="form-button p-2 rounded text-lg" onclick="calculateDietPoints()">–ù–∞–∂–º–∏ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ—á–∫–æ–≤ üçé</button>
            </form>
            <div id="diet-points-output" class="mt-4 p-4 border-t-2 border-gray-600 text-center">
                <!-- Diet Points Output will appear here -->
            </div>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
            <form id="store-form" class="flex flex-col space-y-4 mt-8">
                <input type="text" class="form-input" id="item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞" required>
                <input type="number" class="form-input" id="item-calories" placeholder="–ö–∞–ª–æ—Ä–∏–∏ –≤ –ø—Ä–æ–¥—É–∫—Ç–µ" required>
                <select class="form-input" id="item-category">
                    <option value="common">–û–±—ã—á–Ω–æ–µ</option>
                    <option value="drink">–ù–∞–ø–∏—Ç–æ–∫</option>
                    <option value="homemade">–î–æ–º–∞—à–Ω–µ–µ</option>
                </select>
                <button type="button" class="form-button" onclick="addItemToStore()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <span id="store-message"></span>
            </form>

            <div id="store-output" class="mt-4 p-4 border-t-2 border-gray-600"> 
                <h2 class="text-xl mb-2">–ú–∞–≥–∞–∑–∏–Ω</h2>
                <ul id="store-list">
                    <!-- Store items will appear here -->
                </ul>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mt-4">
                <div id="purchase-history-output" class="flex-1 p-4 border-t-2 border-gray-600">
                    <h2 class="text-xl mb-2">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h2>
                    <ul id="purchase-history">
                        <!-- Purchase history will appear here -->
                    </ul>
                </div>

                <div id="points-history-output" class="flex-1 p-4 border-t-2 border-gray-600">
                    <h2 class="text-xl mb-2">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤</h2>
                    <ul id="points-history">
                        <!-- Points history will appear here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
   
    <script>
        const localStorageKey = 'dietAppStore';
        const pointsKey = 'dietPoints';
        const purchaseHistoryKey = 'purchaseHistory';
        const pointsHistoryKey = 'pointsHistory';
        // –ö–ª—é—á–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        const usersKey = 'dietAppUsers';
        const currentUserKey = 'dietAppCurrentUser';

        const categoryMultipliers = {
            'drink': 0.8,
            'homemade': 0.5,
            'common': 1.0
        };
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = localStorage.getItem(currentUserKey);
            if (currentUser) {
                initApp(currentUser);
            } else {
                document.getElementById('auth-container').classList.remove('hidden');
            }
        });

        function login() {
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;
            
            if (!username || !password) {
                alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");
                return;
            }
            
            const users = JSON.parse(localStorage.getItem(usersKey)) || [];
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                localStorage.setItem(currentUserKey, username);
                initApp(username);
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
            }
        }

        function register() {
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;
            
            if (!username || !password) {
                alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");
                return;
            }
            
            const users = JSON.parse(localStorage.getItem(usersKey)) || [];
            
            if (users.some(u => u.username === username)) {
                alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
                return;
            }
            
            users.push({ username, password });
            localStorage.setItem(usersKey, JSON.stringify(users));
            localStorage.setItem(currentUserKey, username);
            
            initApp(username);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function initApp(username) {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª—é—á–∏ localStorage –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            window.localStorageKey = `dietAppStore_${username}`;
            window.pointsKey = `dietPoints_${username}`;
            window.purchaseHistoryKey = `purchaseHistory_${username}`;
            window.pointsHistoryKey = `pointsHistory_${username}`;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadStoredDietPoints();
            loadStoreItems();
            loadPurchaseHistory();
            loadPointsHistory();
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem(currentUserKey);
            location.reload();
        }

        function loadStoredDietPoints() {
            const savedPoints = parseInt(localStorage.getItem(pointsKey)) || 0;
            document.getElementById('diet-points').innerText = savedPoints;
        }
        
        function calculateDietPoints() {
            const calConsumed = parseInt(document.getElementById('cal-consumed').value);
            const calBurned = parseInt(document.getElementById('cal-burned').value);
            if (isNaN(calConsumed) || isNaN(calBurned)) {
                alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ –∫–∞–ª–æ—Ä–∏–π –≤ –æ–±–∞ –ø–æ–ª—è");
                return;
            }
            const points = calBurned * 3 - calConsumed;
            const pointsOutput = document.getElementById('diet-points-output');
            if (points > 0 && points < 10000) {
                pointsOutput.innerText = `–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª ${points} –æ—á–∫–æ–≤! üéâ`;
                updateDietPoints(points, calConsumed, calBurned);
            } else if (points < 0){
                pointsOutput.innerText = `–û–æ–æ –Ω–µ—Ç! –¢—ã –ø–æ—Ç–µ—Ä—è–ª ${points} –æ—á–∫–æ–≤! üéâ`;
                updateDietPoints(points, calConsumed, calBurned);
            } else if (points == 0){
                pointsOutput.innerText = `–¢—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª`;
                updateDietPoints(points, calConsumed, calBurned);
            } else {
                pointsOutput.innerText = `–ê —Ç—ã –Ω–æ–ª–∏–∫–æ–º –Ω–µ –æ—à–∏–±—Å—è?`;
            } 
        }

        function updateDietPoints(points, calConsumed, calBurned) {
            let currentPoints = parseInt(localStorage.getItem(pointsKey)) || 0;
            currentPoints += points;
            localStorage.setItem(pointsKey, currentPoints);
            if (currentPoints > 100000){
                const pointsOutput = document.getElementById('diet-points-message');
                pointsOutput.innerText = `–ê –Ω–µ –º–Ω–æ–≥–æ–≤–∞—Ç–æ?`;
            } else {
                const pointsOutput = document.getElementById('diet-points-message');
                pointsOutput.innerText = ``;
            }
            document.getElementById('diet-points').innerText = currentPoints;
            let pointsHistory = JSON.parse(localStorage.getItem(pointsHistoryKey)) || [];
            const changeRecord = {
                date: new Date().toLocaleString(),
                change: points,
                total: currentPoints,
                details: {
                    consumed: calConsumed,
                    burned: calBurned,
                    calculation: `(${calBurned} √ó 2) - ${calConsumed} = ${points}`
                }
            };
            pointsHistory.push(changeRecord);
            localStorage.setItem(pointsHistoryKey, JSON.stringify(pointsHistory));
            loadPointsHistory();
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è "–≤—Ä–µ–¥–Ω–æ—Å—Ç–∏"
        function getSinLevel(calories) {
            if (calories > 350) return 2; // –í—Ä–µ–¥–Ω–æ
            if (calories < 100) return 0; // –ø–æ–ª–µ–∑–Ω–æ
            return 1; // –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —É—Ä–æ–≤–Ω—è –≤—Ä–µ–¥–Ω–æ—Å—Ç–∏
        function getSinBadge(sinLevel) {
            const badges = [
                '<span class="badge-healthy px-2 py-1 rounded">ü•ó –ü–æ–ª–µ–∑–Ω–æ</span>',
                '<span class="px-2 py-1 rounded">‚ö†Ô∏è –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span>',
                '<span class="badge-warning px-2 py-1 rounded">üç© –í—Ä–µ–¥–Ω–æ</span>',
            ];
            return badges[sinLevel] || '';
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –º–∞–≥–∞–∑–∏–Ω
        function addItemToStore() {
            const itemName = document.getElementById('item-name').value;
            const calories = parseInt(document.getElementById('item-calories').value);
            const itemCategory = document.getElementById('item-category').value;
            
            if (!itemName || isNaN(calories)) {
                alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞–ª–æ—Ä–∏–∏!");
                return;
            }

            let price = calories * 10;
            price *= categoryMultipliers[itemCategory];

            const sinLevel = getSinLevel(calories);
            const badge = getSinBadge(sinLevel);

            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            let itemExists = false;
            storeItems.forEach((item, index) => {
                if(itemName==item.name){
                    itemExists = true;
                }
            });
            const storeMessage = document.getElementById('store-message');
            if(itemExists == false){
                storeItems.push({ 
                    name: itemName, 
                    price: price,
                    calories: calories,
                    itemCategory: itemCategory,
                    sin: badge
                });
                storeMessage.innerText = ``;
            }
            else{
                storeMessage.innerText = `–¢–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –µ—Å—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ`;
            }
            
            localStorage.setItem(localStorageKey, JSON.stringify(storeItems));
            loadStoreItems();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
        function loadStoreItems() {
            const storeList = document.getElementById('store-list');
            storeList.innerHTML = '';
            
            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            
            storeItems.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'my-1 p-2 bg-gray-800 rounded flex justify-between items-center';
                
                listItem.innerHTML = `
                    <div>
                        <span class="font-medium">${item.name}</span>
                        <span class="text-sm text-gray-400 ml-2">${item.calories} –∫–∫–∞–ª </span>
                        <span class="font-medium ml-2">${item.sin}</span>
                    </div>
                    <div>
                        <button onclick="purchaseItem(${index})" class="bg-green-600 text-white p-1 rounded mr-2">
                            –ö—É–ø–∏—Ç—å (${item.price} –æ—á–∫–æ–≤)
                        </button>
                        <button onclick="removeItemFromStore(${index})" class="bg-red-600 text-white p-1 rounded">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                `;
                
                storeList.appendChild(listItem);
            });
        }


        function loadPurchaseHistory() {
            const purchaseList = document.getElementById('purchase-history');
            purchaseList.innerHTML = ''; // Clear current list

            let purchaseHistory = JSON.parse(localStorage.getItem(purchaseHistoryKey)) || [];
            purchaseHistory.forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'my-1 p-2 bg-gray-800 rounded';
                listItem.innerHTML = `
                    <div class="text-sm text-gray-400">${item.date}</div>
                    <div class="text-sm mt-1">${item.details.name} - –ö—É–ø–ª–µ–Ω–æ –∑–∞ ${item.details.price} –æ—á–∫–æ–≤</div>
                `;
                purchaseList.appendChild(listItem);
            });
        }

        function loadPointsHistory() {
            const pointsList = document.getElementById('points-history');
            pointsList.innerHTML = '';

            let pointsHistory = JSON.parse(localStorage.getItem(pointsHistoryKey)) || [];
            pointsHistory.slice().reverse().forEach(record => { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–≤—ã–º–∏
                const listItem = document.createElement('li');
                listItem.className = 'my-1 p-2 bg-gray-800 rounded';
                
                const changeClass = record.change > 0 ? 'text-green-400' : 'text-red-400';
                const changeSymbol = record.change > 0 ? '+' : '';
                
                listItem.innerHTML = `
                    <div class="text-sm text-gray-400">${record.date}</div>
                    <div class="text-sm mt-1">–ü–æ–ª—É—á–µ–Ω–æ: ${record.details.consumed} –∫–∞–ª | –°–æ–∂–∂–µ–Ω–æ: ${record.details.burned} –∫–∞–ª</div>
                    <div class="text-sm">–†–∞—Å—á—ë—Ç: ${record.details.calculation}</div>
                    <div class="text-right mt-1">–ò—Ç–æ–≥–æ: ${record.total} –æ—á–∫–æ–≤</div>
                `;
                pointsList.appendChild(listItem);
            });
        }

        function removeItemFromStore(index) {
            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            if (index >= 0 && index < storeItems.length) {
                storeItems.splice(index, 1);
                localStorage.setItem(localStorageKey, JSON.stringify(storeItems));
                loadStoreItems();
            } 
        }
        
        function purchaseItem(index) {
            let storeItems = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            let purchaseHistory = JSON.parse(localStorage.getItem(purchaseHistoryKey)) || [];
            let currentPoints = parseInt(localStorage.getItem(pointsKey)) || 0;
            const itemPrice = storeItems[index].price;
            const itemName = storeItems[index].name;
            if (currentPoints >= itemPrice) {
                currentPoints -= itemPrice;
                let purchasedItem = storeItems[index]; 
                const changeRecord = {
                    date: new Date().toLocaleString(),
                    details: {
                        name: itemName,
                        price: itemPrice
                    }
                };
                purchaseHistory.push(changeRecord);
                localStorage.setItem(purchaseHistoryKey, JSON.stringify(purchaseHistory));
                localStorage.setItem(pointsKey, currentPoints);
                if (currentPoints < 100000){
                    const pointsOutput = document.getElementById('diet-points-message');
                    pointsOutput.innerText = ``;
                } 
                document.getElementById('diet-points').innerText = currentPoints;
                loadPurchaseHistory();
                alert("–¢—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª –ø—Ä–µ–¥–º–µ—Ç: " + itemName + "!");
            } else {
                alert("–£ —Ç–µ–±—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!");
            }
        }
        function resetUserData() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!")) {
                localStorage.removeItem(localStorageKey);
                localStorage.removeItem(pointsKey);
                localStorage.removeItem(purchaseHistoryKey);
                localStorage.removeItem(pointsHistoryKey);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                loadStoredDietPoints();
                loadStoreItems();
                loadPurchaseHistory();
                loadPointsHistory();
                
                alert("–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã!");
            }
        }
    </script>
</body>
</html>
